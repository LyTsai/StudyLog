{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport { getCurrentInstance, reactive, ref, unref } from 'vue';\nexport default {\n  setup() {\n    const queryInfo = reactive({\n      query: '',\n      pagenum: 1,\n      pagesize: 10\n    });\n    const userlist = reactive([{\n      _id: '12345',\n      username: 'userOne',\n      first_name: 'User',\n      last_name: 'one',\n      password: 'slowaging123',\n      address: 'long long text to see',\n      profession: ['a', 'b', 'c'],\n      email: 'hello@163.com',\n      cell: '1000000'\n    }, {\n      _id: '12ddd345',\n      username: 'user2',\n      first_name: 'User',\n      last_name: '2',\n      password: 'slowaging123d',\n      profession: ['a', 'b'],\n      email: 'hello@163.com'\n    }, {\n      _id: '1dsgad5',\n      username: 'user2',\n      first_name: 'User',\n      last_name: '2',\n      password: 'slowaging123d',\n      profession: ['a', 'b'],\n      email: 'hello@163.com'\n    }, {\n      _id: '1daggag5',\n      username: 'user2',\n      first_name: 'User',\n      last_name: '2',\n      password: 'slowaging123d',\n      profession: ['a', 'b'],\n      email: 'hello@163.com'\n    }, {\n      _id: '12dagdgae5',\n      username: 'user2',\n      first_name: 'User',\n      last_name: '2',\n      password: 'slowaging123d',\n      profession: ['a', 'b'],\n      email: 'hello@163.com'\n    }, {\n      _id: '12agadd345',\n      username: 'user2',\n      first_name: 'User',\n      last_name: '2',\n      password: 'slowaging123d',\n      profession: ['a', 'b'],\n      email: 'hello@163.com'\n    }]);\n    const total = ref(0); // add form\n\n    const addFormRef = ref();\n    const showForAdd = ref(true);\n    const userId = ref('');\n    const dialogVisible = ref(false);\n    const addForm = reactive({\n      username: '',\n      password: '',\n      first_name: '',\n      last_name: '',\n      address: '',\n      profession: [],\n      email: '',\n      cell: ''\n    }); // rules\n\n    var checkEmail = (rule, value, cb) => {\n      const regEmail = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\\.[a-zA-Z0-9_-])+/;\n\n      if (regEmail.test(value)) {\n        return cb();\n      }\n\n      cb(new Error('Please input a valid email address'));\n    };\n\n    const addFormRules = reactive({\n      username: [{\n        required: true,\n        message: 'Input user name',\n        trigger: 'blur'\n      }],\n      password: [{\n        required: true,\n        message: 'Input user password',\n        trigger: 'blur'\n      }],\n      email: [// { message: 'Input a valid email address', trigger: 'blur' },\n      {\n        validator: checkEmail,\n        trigger: 'blur'\n      }]\n    }); // page\n\n    const handleSizeChange = size => {\n      queryInfo.pagesize = size;\n      getUserList();\n    };\n\n    const handleCurrentChange = page => {\n      queryInfo.pagenum = page;\n      getUserList();\n    }; // user buttons\n\n\n    const editUserClicked = id => {\n      showForAdd.value = false;\n      userId.value = id;\n      const user = getUserInfoByID(id).user;\n      addForm.username = user.username;\n      addForm.password = user.password;\n      addForm.first_name = user.first_name;\n      addForm.last_name = user.last_name;\n      addForm.address = user.address;\n      addForm.profession = user.profession;\n      addForm.email = user.email;\n      addForm.cell = user.cell;\n      dialogVisible.value = true;\n    };\n\n    const {\n      proxy\n    } = getCurrentInstance();\n\n    const deleteUserClicked = async id => {\n      const confirmResult = await proxy.$confirm('This User Will be deleted.', 'Warning', {\n        confirmButtonText: 'Confirm',\n        cancelButtonText: 'Cancel',\n        type: 'warning'\n      }).catch(error => error);\n\n      if (confirmResult !== 'confirm') {// cancel\n      } else {\n        deleteUser(id);\n      }\n    }; // dialog\n\n\n    const addUserClicked = () => {\n      addForm.username = '';\n      addForm.password = '';\n      addForm.first_name = '';\n      addForm.last_name = '';\n      addForm.address = '';\n      addForm.profession = [];\n      addForm.email = '';\n      addForm.cell = '';\n      showForAdd.value = true;\n      dialogVisible.value = true;\n    };\n\n    const dialogClosed = () => {\n      // clear form\n      // addForm.username = ''\n      // addForm.password = ''\n      // addForm.first_name = ''\n      // addForm.last_name = ''\n      // addForm.address = ''\n      // addForm.profession = []\n      // addForm.email = ''\n      // addForm.cell = ''\n      // const form = unref(addFormRef)\n      // form.resetFields()\n      dialogVisible.value = false;\n    };\n\n    const createUser = async () => {\n      const form = unref(addFormRef);\n      if (!form) return;\n      await form.validate((valid, fields) => {\n        if (valid) {\n          if (showForAdd.value) {\n            addUser();\n          } else {\n            updateUser();\n          }\n\n          addUser();\n        } else {\n          console.log('error submit!', fields);\n        }\n      });\n    }; // api functions\n\n\n    const getUserList = async () => {\n      // const result = await proxy.$http.get('/api/user', {\n      //   params: queryInfo\n      // })\n      // console.log(result)\n      total.value = userlist.length;\n    };\n\n    const addUser = async () => {\n      // name used?\n      // const add = await proxy.$http.post('/api/user', {\n      //   params: addForm.value\n      // })\n      // console.log(add)\n      console.log(addForm);\n      userlist.push(addForm);\n      getUserList();\n      dialogClosed();\n    };\n\n    async function deleteUser(id) {\n      // delete by id\n      // const deleted = await proxy.$http.delele('/api/user', {\n      //   params: {\n      //     _id: id\n      //   }\n      // })\n      // console.log(deleted)\n      const index = getUserInfoByID(id).index;\n      userlist.splice(index, 1);\n      getUserList();\n    }\n\n    function getUserInfoByID(id) {\n      for (let index = 0; index < userlist.length; index++) {\n        const element = userlist[index];\n\n        if (element._id === id) {\n          return {\n            user: element,\n            index: index\n          };\n        }\n      }\n    }\n\n    const updateUser = () => {\n      const id = unref(userId);\n      const user = getUserInfoByID(id).user;\n      addForm.username = user.username;\n      addForm.password = user.password;\n      addForm.first_name = user.first_name;\n      addForm.last_name = user.last_name;\n      addForm.address = user.address;\n      addForm.profession = user.profession;\n      addForm.email = user.email;\n      addForm.cell = user.cell;\n      dialogVisible.value = true;\n    };\n\n    return {\n      queryInfo,\n      userlist,\n      total,\n      showForAdd,\n      userId,\n      dialogVisible,\n      addFormRef,\n      addForm,\n      addFormRules,\n      handleSizeChange,\n      handleCurrentChange,\n      addUserClicked,\n      editUserClicked,\n      deleteUserClicked,\n      dialogClosed,\n      createUser,\n      updateUser\n    };\n  }\n\n};","map":{"version":3,"mappings":"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","names":["getCurrentInstance","reactive","ref","unref","setup","queryInfo","query","pagenum","pagesize","userlist","_id","username","first_name","last_name","password","address","profession","email","cell","total","addFormRef","showForAdd","userId","dialogVisible","addForm","checkEmail","rule","value","cb","regEmail","test","Error","addFormRules","required","message","trigger","validator","handleSizeChange","size","getUserList","handleCurrentChange","page","editUserClicked","id","user","getUserInfoByID","proxy","deleteUserClicked","confirmResult","$confirm","confirmButtonText","cancelButtonText","type","catch","error","deleteUser","addUserClicked","dialogClosed","createUser","form","validate","valid","fields","addUser","updateUser","console","log","length","push","index","splice","element"],"sourceRoot":"","sources":["/Volumes/iMacDisk/Users/Shared/GitHub/StudyLog/sharemap_manage/src/views/user/UserList.vue"],"sourcesContent":["<template>\n  <div>\n    <el-breadcrumb separator-class=\"el-icon-arrow-right\">\n      <el-breadcrumb-item :to=\"{ path: '/home' }\">Home</el-breadcrumb-item>\n      <el-breadcrumb-item>User Management</el-breadcrumb-item>\n      <el-breadcrumb-item>User List</el-breadcrumb-item>\n    </el-breadcrumb>\n    <!-- list -->\n    <el-card>\n      <!-- search and add -->\n      <el-row :gutter=\"20\">\n        <el-col :span=\"8\">\n          <el-input placeholder=\"Input name\" v-model=\"queryInfo.query\" clearable @clear=\"getUserList\">\n            <template  #append>\n              <el-button type=\"primary\" :icon=\"Search\" @click=\"getUserList\">Search</el-button>\n            </template>\n          </el-input>\n        </el-col>\n        <el-col :span=\"4\">\n          <el-button type=\"primary\" @click=\"addUserClicked\">Add User</el-button>\n        </el-col>\n      </el-row>\n      <!-- table -->\n       <!-- height=\"50\" -->\n      <el-table :data=\"userlist\" border stripe>\n        <el-table-column type=\"index\"></el-table-column>\n        <el-table-column label=\"Username\" prop=\"username\"></el-table-column>\n        <el-table-column label=\"Name\">\n          <template #default=\"scope\">{{scope.row.first_name}} {{scope.row.last_name}}</template>\n        </el-table-column>\n        <el-table-column label=\"Address\" prop=\"address\"></el-table-column>\n        <el-table-column label=\"Profession\" prop=\"profession\"></el-table-column>\n        <el-table-column label=\"Email\" prop=\"email\"></el-table-column>\n        <el-table-column label=\"Cell\" prop=\"cell\"></el-table-column>\n        <el-table-column fixed=\"right\" label=\"Operations\" width=\"110\">\n          <template #default=\"scope\">\n            <!-- buttons -->\n            <el-button type=\"text\" size=\"small\" @click=\"editUserClicked(scope.row._id)\">Edit</el-button>\n            <el-button type=\"text\" size=\"small\" @click=\"deleteUserClicked(scope.row._id)\">Delete</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n      <!-- paging -->\n      <el-pagination @size-change=\"handleSizeChange\" @current-change=\"handleCurrentChange\" :current-page=\"queryInfo.pagenum\" :page-sizes=\"[1, 2, 5, 10]\" :page-size=\"queryInfo.pagesize\" layout=\"total, sizes, prev, pager, next, jumper\" :total=\"total\">\n      </el-pagination>\n    </el-card>\n    <!-- add or modify User -->\n    <el-dialog :title=\"showForAdd ? 'Add User' : 'Modify User'\" v-model=\"dialogVisible\" width=\"50%\" @close=\"dialogClosed\">\n      <!-- edit -->\n      <el-form :model=\"addForm\" :rules=\"addFormRules\" ref=\"addFormRef\" label-width=\"100px\">\n        <el-form-item label=\"Username\" prop=\"username\">\n          <el-input v-model=\"addForm.username\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"Password\" prop=\"password\">\n          <el-input v-model=\"addForm.password\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"Name\">\n          <el-col :span=\"11\">\n            <el-form-item prop=\"first_name\">\n             <el-input v-model=\"addForm.first_name\" placeholder=\"first name\"></el-input>\n            </el-form-item>\n          </el-col>\n          <el-col :span=\"2\" class=\"text-center\">\n          </el-col>\n          <el-col :span=\"11\">\n            <el-form-item prop=\"last_name\">\n              <el-input v-model=\"addForm.last_name\" placeholder=\"last name\"></el-input>\n            </el-form-item>\n        </el-col>\n        </el-form-item>\n        <el-form-item label=\"Address\" prop=\"address\">\n          <el-input v-model=\"addForm.address\" type=\"textarea\"/>\n        </el-form-item>\n        <el-form-item label=\"Profession\" prop=\"profession\">\n          <el-checkbox-group v-model=\"addForm.profession\">\n            <el-checkbox label = \"Medical Professional\" name=\"profession\"></el-checkbox>\n            <el-checkbox label = \"Educator\" name=\"profession\"></el-checkbox>\n            <el-checkbox label = \"Reasearcher\" name=\"profession\"></el-checkbox>\n          </el-checkbox-group>\n        </el-form-item>\n        <el-form-item label=\"Email\" prop=\"email\">\n          <el-input v-model=\"addForm.email\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"Cell\" prop=\"mobile\">\n          <el-input v-model=\"addForm.cell\"></el-input>\n        </el-form-item>\n        <!-- bottom -->\n        <el-form-item>\n          <el-button @click=\"dialogClosed\">Cancel</el-button>\n          <el-button type=\"primary\" @click=\"createUser\">Confirm</el-button>\n        </el-form-item>\n      </el-form>\n    </el-dialog>\n    <!-- delelte -->\n  </div>\n</template>\n<script>\nimport { getCurrentInstance, reactive, ref, unref } from 'vue'\nexport default {\n  setup () {\n    const queryInfo = reactive({\n      query: '',\n      pagenum: 1,\n      pagesize: 10\n    })\n\n    const userlist = reactive([{\n      _id: '12345',\n      username: 'userOne',\n      first_name: 'User',\n      last_name: 'one',\n      password: 'slowaging123',\n      address: 'long long text to see',\n      profession: ['a', 'b', 'c'],\n      email: 'hello@163.com',\n      cell: '1000000'\n    }, {\n      _id: '12ddd345',\n      username: 'user2',\n      first_name: 'User',\n      last_name: '2',\n      password: 'slowaging123d',\n      profession: ['a', 'b'],\n      email: 'hello@163.com'\n    }, {\n      _id: '1dsgad5',\n      username: 'user2',\n      first_name: 'User',\n      last_name: '2',\n      password: 'slowaging123d',\n      profession: ['a', 'b'],\n      email: 'hello@163.com'\n    }, {\n      _id: '1daggag5',\n      username: 'user2',\n      first_name: 'User',\n      last_name: '2',\n      password: 'slowaging123d',\n      profession: ['a', 'b'],\n      email: 'hello@163.com'\n    }, {\n      _id: '12dagdgae5',\n      username: 'user2',\n      first_name: 'User',\n      last_name: '2',\n      password: 'slowaging123d',\n      profession: ['a', 'b'],\n      email: 'hello@163.com'\n    }, {\n      _id: '12agadd345',\n      username: 'user2',\n      first_name: 'User',\n      last_name: '2',\n      password: 'slowaging123d',\n      profession: ['a', 'b'],\n      email: 'hello@163.com'\n    }])\n    const total = ref(0)\n    // add form\n    const addFormRef = ref()\n    const showForAdd = ref(true)\n    const userId = ref('')\n    const dialogVisible = ref(false)\n    const addForm = reactive({\n      username: '',\n      password: '',\n      first_name: '',\n      last_name: '',\n      address: '',\n      profession: [],\n      email: '',\n      cell: ''\n    })\n    // rules\n    var checkEmail = (rule, value, cb) => {\n      const regEmail = /^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\\.[a-zA-Z0-9_-])+/\n      if (regEmail.test(value)) {\n        return cb()\n      }\n      cb(new Error('Please input a valid email address'))\n    }\n    const addFormRules = reactive({\n      username: [\n        { required: true, message: 'Input user name', trigger: 'blur' }\n      ],\n      password: [\n        { required: true, message: 'Input user password', trigger: 'blur' }\n      ],\n      email: [\n        // { message: 'Input a valid email address', trigger: 'blur' },\n        { validator: checkEmail, trigger: 'blur' }\n      ]\n    })\n\n    // page\n    const handleSizeChange = (size) => {\n      queryInfo.pagesize = size\n      getUserList()\n    }\n    const handleCurrentChange = (page) => {\n      queryInfo.pagenum = page\n      getUserList()\n    }\n    // user buttons\n    const editUserClicked = (id) => {\n      showForAdd.value = false\n      userId.value = id\n      const user = getUserInfoByID(id).user\n      addForm.username = user.username\n      addForm.password = user.password\n      addForm.first_name = user.first_name\n      addForm.last_name = user.last_name\n      addForm.address = user.address\n      addForm.profession = user.profession\n      addForm.email = user.email\n      addForm.cell = user.cell\n      dialogVisible.value = true\n    }\n    const { proxy } = getCurrentInstance()\n    const deleteUserClicked = async (id) => {\n      const confirmResult = await proxy.$confirm(\n        'This User Will be deleted.',\n        'Warning',\n        {\n          confirmButtonText: 'Confirm',\n          cancelButtonText: 'Cancel',\n          type: 'warning'\n        }\n      ).catch(error => error)\n      if (confirmResult !== 'confirm') {\n        // cancel\n      } else {\n        deleteUser(id)\n      }\n    }\n    // dialog\n    const addUserClicked = () => {\n      addForm.username = ''\n      addForm.password = ''\n      addForm.first_name = ''\n      addForm.last_name = ''\n      addForm.address = ''\n      addForm.profession = []\n      addForm.email = ''\n      addForm.cell = ''\n      showForAdd.value = true\n      dialogVisible.value = true\n    }\n    const dialogClosed = () => {\n      // clear form\n      // addForm.username = ''\n      // addForm.password = ''\n      // addForm.first_name = ''\n      // addForm.last_name = ''\n      // addForm.address = ''\n      // addForm.profession = []\n      // addForm.email = ''\n      // addForm.cell = ''\n      // const form = unref(addFormRef)\n      // form.resetFields()\n      dialogVisible.value = false\n    }\n    const createUser = async () => {\n      const form = unref(addFormRef)\n      if (!form) return\n      await form.validate((valid, fields) => {\n        if (valid) {\n          if (showForAdd.value) {\n            addUser()\n          } else {\n            updateUser()\n          }\n          addUser()\n        } else {\n          console.log('error submit!', fields)\n        }\n      })\n    }\n    // api functions\n    const getUserList = async () => {\n      // const result = await proxy.$http.get('/api/user', {\n      //   params: queryInfo\n      // })\n      // console.log(result)\n      total.value = userlist.length\n    }\n    const addUser = async () => {\n      // name used?\n      // const add = await proxy.$http.post('/api/user', {\n      //   params: addForm.value\n      // })\n      // console.log(add)\n      console.log(addForm)\n      userlist.push(addForm)\n      getUserList()\n      dialogClosed()\n    }\n    async function deleteUser (id) {\n      // delete by id\n      // const deleted = await proxy.$http.delele('/api/user', {\n      //   params: {\n      //     _id: id\n      //   }\n      // })\n      // console.log(deleted)\n      const index = getUserInfoByID(id).index\n      userlist.splice(index, 1)\n      getUserList()\n    }\n\n    function getUserInfoByID (id) {\n      for (let index = 0; index < userlist.length; index++) {\n        const element = userlist[index]\n        if (element._id === id) {\n          return {\n            user: element,\n            index: index\n          }\n        }\n      }\n    }\n    const updateUser = () => {\n      const id = unref(userId)\n      const user = getUserInfoByID(id).user\n      addForm.username = user.username\n      addForm.password = user.password\n      addForm.first_name = user.first_name\n      addForm.last_name = user.last_name\n      addForm.address = user.address\n      addForm.profession = user.profession\n      addForm.email = user.email\n      addForm.cell = user.cell\n      dialogVisible.value = true\n    }\n    return { queryInfo, userlist, total, showForAdd, userId, dialogVisible, addFormRef, addForm, addFormRules, handleSizeChange, handleCurrentChange, addUserClicked, editUserClicked, deleteUserClicked, dialogClosed, createUser, updateUser }\n  }\n}\n</script>\n<style lang=\"less\" scoped>\n\n</style>\n"]},"metadata":{},"sourceType":"module"}