{"ast":null,"code":"import \"core-js/modules/es.error.cause.js\";\nimport { getCurrentInstance, reactive, ref, unref } from 'vue';\nexport default {\n  setup(props) {\n    const loginFormRef = ref();\n    const loginForm = reactive({\n      username: '',\n      password: ''\n    });\n    const loginFormRules = reactive({\n      username: [{\n        required: true,\n        message: 'Please input a valid account',\n        trigger: 'blur'\n      }],\n      password: [{\n        required: true,\n        message: 'Please input password',\n        trigger: 'blur'\n      }]\n    });\n\n    const resetLoginForm = () => {\n      const formEl = unref(loginFormRef);\n      formEl.resetFields();\n    };\n\n    const login = async () => {\n      const formEl = unref(loginFormRef);\n      if (!formEl) return;\n\n      try {} catch (error) {\n        console.log(error);\n      }\n\n      await formEl.validate((valid, fields) => {\n        if (valid) {\n          console.log('valid');\n          accessLogin();\n        } else {\n          console.log('dddd');\n          console.log('error submit!', fields);\n        }\n      });\n    };\n\n    function accessLogin() {\n      const {\n        proxy\n      } = getCurrentInstance();\n      const loginUrl = 'https://annielyticx-gamedataauth.azurewebsites.net/oauth/token';\n      const body = 'username=' + loginForm.username + '&password=' + loginForm.password + '&grant_type=password';\n      fetch(loginUrl, {\n        method: 'post',\n        body: body,\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        }\n      }).then(response => {\n        console.log(response);\n\n        if (!response.ok) {\n          throw new Error('Failed to login' + response.status);\n        }\n\n        return response.json();\n      }).then(result => {\n        const token = result.access_token;\n        window.sessionStorage.setItem('token', token);\n        proxy.$router.push('/home');\n      }).catch(error => {\n        alert('Failed to login :' + error);\n      });\n    }\n\n    return {\n      loginFormRef,\n      loginForm,\n      loginFormRules,\n      resetLoginForm,\n      login\n    };\n  }\n\n};","map":{"version":3,"mappings":";AA2BA,SAASA,kBAAT,EAA6BC,QAA7B,EAAuCC,GAAvC,EAA4CC,KAA5C,QAAyD,KAAzD;AACA,eAAe;AACbC,OAAI,CAAGC,KAAH,EAAU;AACZ,UAAMC,YAAW,GAAIJ,GAAG,EAAxB;AACA,UAAMK,SAAQ,GAAIN,QAAQ,CAAC;AACzBO,cAAQ,EAAE,EADe;AAEzBC,cAAQ,EAAE;AAFe,KAAD,CAA1B;AAIA,UAAMC,cAAa,GAAIT,QAAQ,CAAC;AAC9BO,cAAQ,EAAE,CACR;AAAEG,gBAAQ,EAAE,IAAZ;AAAkBC,eAAO,EAAE,8BAA3B;AAA2DC,eAAO,EAAE;AAApE,OADQ,CADoB;AAI9BJ,cAAQ,EAAE,CACR;AAAEE,gBAAQ,EAAE,IAAZ;AAAkBC,eAAO,EAAE,uBAA3B;AAAoDC,eAAO,EAAE;AAA7D,OADQ;AAJoB,KAAD,CAA/B;;AASA,UAAMC,cAAa,GAAI,MAAM;AAC3B,YAAMC,MAAK,GAAIZ,KAAK,CAACG,YAAD,CAApB;AACAS,YAAM,CAACC,WAAP;AACF,KAHA;;AAKA,UAAMC,KAAI,GAAI,YAAY;AACxB,YAAMF,MAAK,GAAIZ,KAAK,CAACG,YAAD,CAApB;AACA,UAAI,CAACS,MAAL,EAAa;;AACb,UAAI,CAEJ,CAFA,CAEE,OAAOG,KAAP,EAAc;AACdC,eAAO,CAACC,GAAR,CAAYF,KAAZ;AACF;;AACA,YAAMH,MAAM,CAACM,QAAP,CAAgB,CAACC,KAAD,EAAQC,MAAR,KAAmB;AACvC,YAAID,KAAJ,EAAW;AACTH,iBAAO,CAACC,GAAR,CAAY,OAAZ;AACAI,qBAAW;AACb,SAHA,MAGO;AACLL,iBAAO,CAACC,GAAR,CAAY,MAAZ;AACAD,iBAAO,CAACC,GAAR,CAAY,eAAZ,EAA6BG,MAA7B;AACF;AACD,OARK,CAAN;AASF,KAjBA;;AAmBA,aAASC,WAAT,GAAwB;AACtB,YAAM;AAAEC;AAAF,UAAYzB,kBAAkB,EAApC;AACA,YAAM0B,QAAO,GAAI,gEAAjB;AACA,YAAMC,IAAG,GAAI,cAAcpB,SAAS,CAACC,QAAxB,GAAmC,YAAnC,GAAkDD,SAAS,CAACE,QAA5D,GAAuE,sBAApF;AACAmB,WAAK,CAACF,QAAD,EAAW;AACdG,cAAM,EAAE,MADM;AAEdF,YAAI,EAAEA,IAFQ;AAGdG,eAAO,EAAE;AACP,0BAAgB;AADT;AAHK,OAAX,CAAL,CAMGC,IANH,CAMQC,QAAO,IAAK;AAClBb,eAAO,CAACC,GAAR,CAAYY,QAAZ;;AACA,YAAI,CAACA,QAAQ,CAACC,EAAd,EAAkB;AAChB,gBAAM,IAAIC,KAAJ,CAAU,oBAAoBF,QAAQ,CAACG,MAAvC,CAAN;AACF;;AACA,eAAOH,QAAQ,CAACI,IAAT,EAAP;AACD,OAZD,EAYGL,IAZH,CAYQM,MAAK,IAAK;AAChB,cAAMC,KAAI,GAAID,MAAM,CAACE,YAArB;AACAC,cAAM,CAACC,cAAP,CAAsBC,OAAtB,CAA8B,OAA9B,EAAuCJ,KAAvC;AACAb,aAAK,CAACkB,OAAN,CAAcC,IAAd,CAAmB,OAAnB;AACD,OAhBD,EAgBGC,KAhBH,CAgBS3B,KAAI,IAAK;AAChB4B,aAAK,CAAC,sBAAsB5B,KAAvB,CAAL;AACD,OAlBD;AAmBF;;AAEA,WAAO;AACLZ,kBADK;AACSC,eADT;AACoBG,oBADpB;AACoCI,oBADpC;AACoDG;AADpD,KAAP;AAGF;;AApEa,CAAf","names":["getCurrentInstance","reactive","ref","unref","setup","props","loginFormRef","loginForm","username","password","loginFormRules","required","message","trigger","resetLoginForm","formEl","resetFields","login","error","console","log","validate","valid","fields","accessLogin","proxy","loginUrl","body","fetch","method","headers","then","response","ok","Error","status","json","result","token","access_token","window","sessionStorage","setItem","$router","push","catch","alert"],"sourceRoot":"","sources":["/Volumes/iMacDisk/Users/Shared/GitHub/StudyLog/sharemap_manage/src/views/LoginView.vue"],"sourcesContent":["<template>\n<div class=\"login_container\">\n  <div class=\"login_box\">\n    <!-- logo image -->\n    <div class=\"avator_box\">\n      <img src=\"../assets/logo.png\" alt=\"logo\">\n    </div>\n    <el-form ref=\"loginFormRef\" :model=\"loginForm\" :rules=\"loginFormRules\" label-width=\"120\" class=\"login_form\" hide-required-asterisk=false>\n      <!-- username -->\n      <el-form-item label = \"Username:\" prop=\"username\">\n        <el-input v-model=\"loginForm.username\" placeholder=\"Please input Email address\" :prefix-icon=\"Search\"/>\n      </el-form-item>\n        <!-- password -->\n      <el-form-item label = \"Password:\" prop=\"password\">\n        <el-input v-model=\"loginForm.password\" type=\"password\" placeholder=\"Please input password\" show-password :prefix-icon=\"icon-password\"/>\n      </el-form-item>\n        <!-- buttons -->\n      <el-form-item class=\"btns\">\n        <el-button type=\"primary\" @click=\"login\">Log In</el-button>\n        <el-button type=\"info\" @click=\"resetLoginForm\">Reset</el-button>\n      </el-form-item>\n    </el-form>\n  </div>\n</div>\n</template>\n\n<script>\nimport { getCurrentInstance, reactive, ref, unref } from 'vue'\nexport default {\n  setup (props) {\n    const loginFormRef = ref()\n    const loginForm = reactive({\n      username: '',\n      password: ''\n    })\n    const loginFormRules = reactive({\n      username: [\n        { required: true, message: 'Please input a valid account', trigger: 'blur' }\n      ],\n      password: [\n        { required: true, message: 'Please input password', trigger: 'blur' }\n      ]\n    })\n\n    const resetLoginForm = () => {\n      const formEl = unref(loginFormRef)\n      formEl.resetFields()\n    }\n\n    const login = async () => {\n      const formEl = unref(loginFormRef)\n      if (!formEl) return\n      try {\n        \n      } catch (error) {\n        console.log(error)\n      }\n      await formEl.validate((valid, fields) => {\n        if (valid) {\n          console.log('valid')\n          accessLogin()\n        } else {\n          console.log('dddd')\n          console.log('error submit!', fields)\n        }\n      })\n    }\n\n    function accessLogin () {\n      const { proxy } = getCurrentInstance()\n      const loginUrl = 'https://annielyticx-gamedataauth.azurewebsites.net/oauth/token'\n      const body = 'username=' + loginForm.username + '&password=' + loginForm.password + '&grant_type=password'\n      fetch(loginUrl, {\n        method: 'post',\n        body: body,\n        headers: {\n          'Content-Type': 'application/x-www-form-urlencoded'\n        }\n      }).then(response => {\n        console.log(response)\n        if (!response.ok) {\n          throw new Error('Failed to login' + response.status)\n        }\n        return response.json()\n      }).then(result => {\n        const token = result.access_token\n        window.sessionStorage.setItem('token', token)\n        proxy.$router.push('/home')\n      }).catch(error => {\n        alert('Failed to login :' + error)\n      })\n    }\n\n    return {\n      loginFormRef, loginForm, loginFormRules, resetLoginForm, login\n    }\n  }\n}\n</script>\n\n<style lang=\"less\" scoped>\n.login_container {\n    background-color: #2b4b6b;\n    height: 100%;\n}\n\n.login_box {\n    width: 450px;\n    height: 300px;\n    background-color: white;\n    border-radius: 3px;\n    position: absolute;\n    left: 50%;\n    top: 50%;\n    transform: translate(-50%, -50%);\n}\n\n.avator_box {\n    height: 130px;\n    width: 130px;\n    border: 1px solid #eee;\n    border-radius: 50%;\n    padding: 10px;\n    box-shadow: 0 0 10px #ddd;\n    position: absolute;\n    left: 50%;\n    top: -50%;\n    transform: translate(-50%, 50%);\n    background-color: #fff;\n    img {\n        width: 100%;\n        height: 100%;\n        border-radius: 50%;\n        background-color: #eee;\n    }\n}\n\n.login_form {\n    position: absolute;\n    bottom: 0;\n    width: 100%;\n    padding: 0 20px;\n    box-sizing: border-box;\n}\n\n.btns {\n    display: flex;\n    justify-content: flex-end;\n    float: right;\n}\n</style>\n"]},"metadata":{},"sourceType":"module"}